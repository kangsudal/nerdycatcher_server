
# nerdycatcher_server

Renderì— ë°°í¬ë˜ëŠ” WebSocket ì„œë²„

## ì „ì²´ ë°ì´í„° íë¦„  
ESP32 â†’ Render ì†Œì¼“ì„œë²„ â†’ Supabase/Flutterì•±

ESP32ëŠ” ë³´ì•ˆ ì›¹ì†Œì¼“(WSS)ì„ í†µí•´ Renderì— ë°°í¬ëœ ì„œë²„ì— ë°ì´í„°ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.  

## API ì„¤ê³„ ê²½í—˜

ESP32ì™€ Flutter ì•± ê°„ **ì‹¤ì‹œê°„ ë°ì´í„° ì†¡ìˆ˜ì‹ **ì„ ìœ„í•´  
WebSocket ê¸°ë°˜ APIì™€ ì¸ì¦ êµ¬ì¡°ë¥¼ ì§ì ‘ ì„¤ê³„Â·êµ¬í˜„í•œ ê²½í—˜ì´ ìˆìŠµë‹ˆë‹¤.  

- ESP32 â†’ Render ì„œë²„: WebSocket ì—°ê²° ë° API Key ì¸ì¦  
- Render ì„œë²„ â†’ Supabase: ì„¼ì„œ ë°ì´í„° ì €ì¥  
- Render ì„œë²„ â†” Flutter ì•±: ì‹¤ì‹œê°„ ë°ì´í„° ì „ë‹¬ ë° ì œì–´ ë©”ì‹œì§€ ì†¡ìˆ˜ì‹   
- Render ì„œë²„ â†’ Firebase Cloud Messaging: ì¡°ê±´ ë°œìƒ ì‹œ í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡  

### ë°ì´í„° íë¦„ ì˜ˆì‹œ

#### 1. ì¸ì¦ ë©”ì‹œì§€ (ESP32 â†’ Render ì„œë²„)
```json
{
  "type": "auth_device",
  "apiKey": "device-123-abc"
}
```
#### 2. ì„¼ì„œ ë°ì´í„° (ESP32 â†’ Render ì„œë²„ â†’ Supabase/Flutter)
```json
{
  "type": "sensor_data",
  "temperature": 25.7,
  "humidity": 62,
  "light_level": 80,
  "plant_id": "plant_id_123"
}
```
#### 3. ì œì–´ ë©”ì‹œì§€ (Flutter ì•± â†’ Render ì„œë²„ â†’ ESP32)
```json
{
  "type": "led_control",
  "plant_id": "plant_id-123",
  "state": "on"
}
```

#### 4. ì•Œë¦¼ íŠ¸ë¦¬ê±° (Render ì„œë²„ â†’ FCM)
```
await sendPushWithThrottle(
      `low_temp_${plant.id}`,
      `ğŸŒ¡ï¸ ${plant.name} ì €ì˜¨ ê²½ê³ !`,
      `í˜„ì¬ ì˜¨ë„ ${sensorJson.temperature}Â°Cê°€ ì„¤ì •ê°’(${thresholdSettings.temperature_min}Â°C)ë³´ë‹¤ ë‚®ìŠµë‹ˆë‹¤.`
    )
```

### ì¸ì¦ êµ¬ì¡°ë¥¼ ë„£ì€ ì´ìœ 

#### 1.ë³´ì•ˆ ê°•í™”

IoT ê¸°ê¸°(ESP32)ê°€ ì„œë²„ì™€ ì—°ê²°ë  ë•Œ, ì•„ë¬´ ì¥ì¹˜ë‚˜ ì ‘ì†í•˜ë©´ ì•ˆ ë˜ê¸° ë•Œë¬¸ì— API Key ê¸°ë°˜ ì¸ì¦ì„ ë„£ìŒ.

ì´ë¥¼ í†µí•´ í—ˆê°€ë˜ì§€ ì•Šì€ ê¸°ê¸°ê°€ ì„œë²„ì— ë°ì´í„°ë¥¼ ë³´ë‚´ê±°ë‚˜, ì œì–´ ëª…ë ¹ì„ ë°›ëŠ” ê±¸ ë°©ì§€í•¨.

#### 2.ë°ì´í„° ì‹ ë¢°ì„± í™•ë³´

ì¸ì¦ëœ ê¸°ê¸°ì—ì„œ ë“¤ì–´ì˜¨ ë°ì´í„°ë§Œ DB(Supabase)ì— ì €ì¥ë˜ë„ë¡ í•˜ì—¬, ë°ì´í„° ë¬´ê²°ì„±ì„ ë³´ì¥.

ì¶”í›„ ë°ì´í„° ë¶„ì„ì´ë‚˜ ì•Œë¦¼ ì¡°ê±´ì— í™œìš©í•  ë•Œ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë°ì´í„°ë§Œ ë‹¤ë£¸.

#### 3.ì„œë¹„ìŠ¤ í™•ì¥ì„± ê³ ë ¤

ë‹¨ìˆœíˆ í•˜ë‚˜ì˜ ê¸°ê¸°ë§Œ ì“°ëŠ” ê²Œ ì•„ë‹ˆë¼, ì—¬ëŸ¬ ESP32 ê¸°ê¸°ë¥¼ ë¶™ì¼ ìˆ˜ ìˆë„ë¡ ê¸°ê¸°ë³„ ê³ ìœ  API Keyë¥¼ ë°œê¸‰í•´ ê´€ë¦¬ ê°€ëŠ¥.

ë‚˜ì¤‘ì— ì‚¬ìš©ì ê³„ì •ê³¼ ê¸°ê¸°ë¥¼ ë§¤í•‘í•  ë•Œë„ í™•ì¥ì„±ì´ ìƒê¹€.

## ê´€ë ¨ ì €ì¥ì†Œ
- [nerdycatcher_esp32](https://github.com/kangsudal/nerdycatcher_esp32): ì„¼ì„œ ë°ì´í„°ë¥¼ ì¸¡ì •í•˜ê³  ì„œë²„ë¡œ ì „ì†¡í•˜ëŠ” ESP32 ì½”ë“œ

## blog
https://blog.naver.com/kangsudal-dev/223899093772
